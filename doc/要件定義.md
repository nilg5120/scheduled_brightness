# 📄 要件定義書（scheduledBrightness）

## 1. プロジェクト名

**scheduledBrightness**  
（スマート照度スケジューラ）

---

## 2. 目的

ユーザーが任意の時刻に複数の明るさスケジュールを登録し、Androidデバイスの画面照度（輝度）をそのスケジュールに従って自動的に変更できるようにする。

例：  
- 朝は明るく（例：7:00 → 80%）  
- 夜は暗く（例：22:00 → 10%）  
- 自動明るさ調整をスケジュール単位で切り替え

---

## 3. 対象プラットフォーム

| 項目 | 内容 |
|------|------|
| OS | Android 6.0（API 23）以上 |
| デバイス | スマートフォン |
| Flutter SDK | 安定版 |
| iOS | 非対応 |

---

## 4. 機能一覧

### 💡 スケジュール管理

| 機能 | 説明 |
|------|------|
| スケジュール追加・編集 | 指定時刻、モード（自動/手動）、明るさ（0.0〜1.0）を設定 |
| スケジュール削除 | 一覧から削除可能 |
| スケジュールON/OFF | 個別に有効/無効を切り替え可能 |
| スケジュール一覧表示 | 現在登録されているスケジュールのリスト表示 |

### 🔔 明るさ変更トリガー（アラーム）

| 機能 | 説明 |
|------|------|
| 指定時刻に発動 | AlarmManagerを使用し、バックグラウンドでも明るさを変更 |
| 明るさ変更モード | 各スケジュールごとに「自動モード」または「手動明るさ値」を選択 |

### ⚙ 設定画面

| 機能 | 説明 |
|------|------|
| 自動明るさ設定のON/OFF | 明るさモードの手動/自動切り替え（要パーミッション） |
| 明るさ変更の代替手段（オーバーレイ） | 一部端末で明るさ変更不可の場合に、黒のオーバーレイで代用 |
| オーバーレイ制御 | 半透明黒フィルムの表示/非表示切り替え |
| オーバーレイ不透明度調整 | 0%～100%の範囲で不透明度を1%刻みで調整可能 |
| プリセット機能 | 軽く(20%)、普通(50%)、強く(80%)のクイック設定 |
| バージョン表示 | アプリのバージョンを表示 |

---

## 5. パーミッション対応

### WRITE_SETTINGS パーミッション

| 項目 | 内容 |
|------|------|
| 権限名 | `android.permission.WRITE_SETTINGS` |
| 使用目的 | - 明るさ自動/手動切り替え<br>- 実際の明るさを変更 |
| 権限確認 | アプリ起動時や必要時に `Settings.System.canWrite(context)` で確認 |
| 許可誘導 | Flutter → MethodChannel で設定画面 `ACTION_MANAGE_WRITE_SETTINGS` に遷移 |
| 永続性 | 一度ユーザーが許可すれば再許可は不要（アンインストールまで有効） |
| UI例 | 「システム設定の変更を許可してください」→ [許可画面へ] ボタンを用意 |

---

## 6. 非機能要件

| 項目 | 内容 |
|------|------|
| 操作性 | シンプル・直感的なマテリアルデザインUI |
| 永続化 | SharedPreferencesまたはSQLiteでスケジュール保存 |
| セキュリティ | 設定変更時以外に不要なシステムアクセスは行わない |
| バックグラウンド対応 | AlarmManagerを使用し、アプリ非起動時でも実行可能 |

---

## 7. 制約事項・注意点

| 項目 | 内容 |
|------|------|
| WRITE_SETTINGS | ユーザーの手動許可が必須（自動付与不可） |
| Androidの省電力制限 | 一部の端末では AlarmManager の動作に制限がある可能性あり |
| 自動明るさON時 | 設定された手動明るさは上書きされるため、切り替えのUXを工夫 |
| メーカー依存制限 | 一部中華系メーカー端末では設定変更が制限される場合がある |

---

## 8. ユーザーフロー（概要）

1. アプリ起動
2. スケジュール一覧画面で内容を確認・編集
3. ＋ボタンから新しいスケジュールを追加
4. 必要であれば `WRITE_SETTINGS` 権限を許可
5. 指定時刻になると照度が自動変更される

---

## 9. UI画面構成（概要）

### ホーム画面（スケジュール一覧）

- 明るさ状態表示（現在値、自動モードON/OFF）
- スケジュール一覧（時刻／照度／モード／ON/OFFスイッチ）
- 「＋スケジュール追加」ボタン
- 設定画面へのリンク

### スケジュール追加・編集画面

- [🕒 時刻選択]
- [📶 照度モード選択] → 自動 or 手動（スライダー表示）
- [ON/OFF] 有効状態
- 保存／キャンセルボタン

### 設定画面

- 自動明るさ切替スイッチ
- WRITE_SETTINGS 許可確認＆設定画面誘導
- 黒オーバーレイモードの使用可否切り替え
- バージョン表示

---

## 10. 使用予定ライブラリ・技術

| 用途 | パッケージ／技術 |
|------|------------------|
| 明るさ変更 | `screen_brightness` |
| 状態管理 | `provider` or `riverpod` |
| 永続化 | `shared_preferences` または `sqflite` |
| ネイティブ連携 | `MethodChannel`（AlarmManager／パーミッション誘導） |
| 権限制御 | `permission_handler`（WRITE_SETTINGS の補助確認） |
| UI構築 | Flutter Material UI／TimePicker／スライダー |

---

## 11. 拡張予定（将来的機能）

- 曜日別のスケジューリング
- クイック設定タイル（通知バーから即実行）
- 通知による事前アラート
- 明るさ変更の履歴ログ
