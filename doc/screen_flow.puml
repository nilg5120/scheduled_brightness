@startuml 画面遷移図

' スタイル設定
skinparam backgroundColor white
skinparam titleFontSize 18
skinparam titleFontColor black
skinparam titleFontStyle bold
skinparam roundCorner 10
skinparam arrowColor #666666
skinparam activityBorderColor #666666
skinparam activityBackgroundColor #EEEEEE
skinparam activityFontSize 14

title スケジュール明るさアプリ - 画面遷移図

' 画面の定義
(*) --> "アプリ起動" #DDDDDD
"アプリ起動" --> "ホーム画面\n(スケジュール一覧)"

' ホーム画面からの遷移
state "ホーム画面\n(スケジュール一覧)" as HomeScreen {
  state "明るさ状態表示" as BrightnessStatus
  state "スケジュール一覧" as ScheduleList
  state "スケジュール追加ボタン" as AddButton
  state "設定ボタン" as SettingsButton
  
  [*] --> BrightnessStatus
  BrightnessStatus --> ScheduleList
  ScheduleList --> AddButton
  AddButton --> SettingsButton
}

' スケジュール編集画面
state "スケジュール編集画面" as EditScreen {
  state "時刻選択" as TimePicker
  state "明るさモード選択\n(自動/手動)" as ModeSelection
  state "明るさスライダー\n(手動モード時)" as BrightnessSlider
  state "有効/無効スイッチ" as EnabledSwitch
  state "保存/キャンセルボタン" as SaveCancelButtons
  
  [*] --> TimePicker
  TimePicker --> ModeSelection
  ModeSelection --> BrightnessSlider
  BrightnessSlider --> EnabledSwitch
  EnabledSwitch --> SaveCancelButtons
}

' 設定画面
state "設定画面" as SettingsScreen {
  state "システム設定権限状態" as PermissionStatus
  state "自動明るさモード切替" as AutoBrightnessToggle
  state "黒オーバーレイモード切替" as OverlayModeToggle
  state "アプリ情報表示" as AppInfo
  
  [*] --> PermissionStatus
  PermissionStatus --> AutoBrightnessToggle
  AutoBrightnessToggle --> OverlayModeToggle
  OverlayModeToggle --> AppInfo
}

' 削除確認ダイアログ
state "削除確認ダイアログ" as DeleteDialog {
  state "削除/キャンセルボタン" as DeleteButtons
  [*] --> DeleteButtons
}

' システム設定画面（外部）
state "システム設定画面\n(WRITE_SETTINGS権限)" as SystemSettings #DDFFDD

' 画面間の遷移
HomeScreen --> EditScreen : スケジュール追加ボタンをタップ
HomeScreen --> EditScreen : スケジュールの編集ボタンをタップ
HomeScreen --> DeleteDialog : スケジュールの削除ボタンをタップ
HomeScreen --> SettingsScreen : 設定ボタンをタップ

EditScreen --> HomeScreen : 保存ボタンをタップ\n(スケジュールが保存される)
EditScreen --> HomeScreen : キャンセルボタンをタップ\n(変更が破棄される)

DeleteDialog --> HomeScreen : 削除ボタンをタップ\n(スケジュールが削除される)
DeleteDialog --> HomeScreen : キャンセルボタンをタップ

SettingsScreen --> SystemSettings : 「許可する」ボタンをタップ\n(権限がない場合のみ表示)
SettingsScreen --> HomeScreen : 戻るボタンをタップ
SystemSettings --> SettingsScreen : 権限設定後に戻る

' 特殊な遷移（アラーム発火時）
note right of HomeScreen
  指定時刻になると
  バックグラウンドで
  明るさが変更される
  (ユーザー操作なし)
end note

@enduml
